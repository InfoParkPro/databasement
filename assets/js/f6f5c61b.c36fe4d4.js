"use strict";(globalThis.webpackChunkdatabasement_docs=globalThis.webpackChunkdatabasement_docs||[]).push([[730],{2914:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"self-hosting/configuration/backup","title":"Backup","description":"Backup settings (compression, schedules, timeouts, etc.) can be configured directly from the Configuration page in the web UI.","source":"@site/docs/self-hosting/configuration/backup.md","sourceDirName":"self-hosting/configuration","slug":"/self-hosting/configuration/backup","permalink":"/databasement/self-hosting/configuration/backup","draft":false,"unlisted":false,"editUrl":"https://github.com/David-Crty/databasement/tree/main/docs/docs/self-hosting/configuration/backup.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"selfHostingSidebar","previous":{"title":"Application","permalink":"/databasement/self-hosting/configuration/application"},"next":{"title":"Notification","permalink":"/databasement/self-hosting/configuration/notification"}}');var t=i(4848),o=i(8453);const r={sidebar_position:3},a="Backup",c={},l=[{value:"Encrypted Backups",id:"encrypted-backups",level:2},{value:"S3 Storage",id:"s3-storage",level:2},{value:"S3 IAM Permissions",id:"s3-iam-permissions",level:3},{value:"Credentials",id:"credentials",level:3},{value:"S3-Compatible Storage (MinIO, etc.)",id:"s3-compatible-storage-minio-etc",level:3},{value:"Migration from Environment Variables",id:"migration-from-environment-variables",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"backup",children:"Backup"})}),"\n",(0,t.jsxs)(n.p,{children:["Backup settings (compression, schedules, timeouts, etc.) can be configured directly from the ",(0,t.jsx)(n.strong,{children:"Configuration"})," page in the web UI."]}),"\n",(0,t.jsx)(n.p,{children:"This page covers additional setup that requires environment variables."}),"\n",(0,t.jsx)(n.h2,{id:"encrypted-backups",children:"Encrypted Backups"}),"\n",(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"encrypted"})," compression, backups are encrypted with AES-256 using 7-Zip. The encryption key defaults to ",(0,t.jsx)(n.code,{children:"APP_KEY"}),", but you can set a dedicated key:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"BACKUP_ENCRYPTION_KEY=base64:your-32-byte-key-here\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can generate a key with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo "base64:$(openssl rand -base64 32)"\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"If you change the encryption key, you will not be able to restore backups that were encrypted with the previous key. Keep your encryption key safe and backed up separately."})}),"\n",(0,t.jsx)(n.h2,{id:"s3-storage",children:"S3 Storage"}),"\n",(0,t.jsx)(n.p,{children:"Databasement supports AWS S3 and S3-compatible storage (MinIO, DigitalOcean Spaces, etc.) for backup volumes."}),"\n",(0,t.jsxs)(n.p,{children:["All S3 settings (region, credentials, endpoints) are configured ",(0,t.jsx)(n.strong,{children:"per-volume"})," in the web UI when creating or editing an S3 volume. See the ",(0,t.jsx)(n.a,{href:"../../user-guide/volumes#s3-storage",children:"Volumes user guide"})," for field descriptions."]}),"\n",(0,t.jsx)(n.h3,{id:"s3-iam-permissions",children:"S3 IAM Permissions"}),"\n",(0,t.jsx)(n.p,{children:"The AWS credentials used by each S3 volume need these permissions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:PutObject",\n                "s3:GetObject",\n                "s3:DeleteObject",\n                "s3:ListBucket"\n            ],\n            "Resource": [\n                "arn:aws:s3:::your-bucket-name",\n                "arn:aws:s3:::your-bucket-name/*"\n            ]\n        }\n    ]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"credentials",children:"Credentials"}),"\n",(0,t.jsxs)(n.p,{children:["You can provide explicit ",(0,t.jsx)(n.strong,{children:"Access Key ID"})," and ",(0,t.jsx)(n.strong,{children:"Secret Access Key"})," in the volume form. However, credentials are optional \u2014 when left blank, the AWS SDK uses its ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/guide_credentials.html",children:"default credential chain"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Environment variables (",(0,t.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"}),", ",(0,t.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"EC2/ECS instance roles"}),"\n",(0,t.jsx)(n.li,{children:"EKS IRSA (IAM Roles for Service Accounts)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This means deployments on AWS infrastructure can work without storing any credentials in the database."}),"\n",(0,t.jsx)(n.h3,{id:"s3-compatible-storage-minio-etc",children:"S3-Compatible Storage (MinIO, etc.)"}),"\n",(0,t.jsxs)(n.p,{children:["For S3-compatible providers, set the ",(0,t.jsx)(n.strong,{children:"Custom Endpoint"})," and enable ",(0,t.jsx)(n.strong,{children:"Use Path-Style Endpoint"})," in the Advanced S3 Settings section of the volume form."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If your internal endpoint differs from the public URL (e.g., ",(0,t.jsx)(n.code,{children:"http://minio:9000"})," vs ",(0,t.jsx)(n.code,{children:"http://localhost:9000"}),"), set the ",(0,t.jsx)(n.strong,{children:"Public Endpoint"})," field so presigned download URLs work correctly in your browser."]})}),"\n",(0,t.jsx)(n.h3,{id:"migration-from-environment-variables",children:"Migration from Environment Variables"}),"\n",(0,t.jsxs)(n.p,{children:["If you previously configured S3 via environment variables (",(0,t.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"}),", ",(0,t.jsx)(n.code,{children:"AWS_REGION"}),", etc.), the migration automatically copies those values into each existing S3 volume's config. After upgrading, you can remove the AWS environment variables from your ",(0,t.jsx)(n.code,{children:".env"})," file."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(6540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);